<!-- TOC -->

- [TNT和爆炸](#tnt和爆炸)
- [当活塞开始推动](#当活塞开始推动)
- [刷地毯机、刷铁轨机、TNT复制机](#刷地毯机刷铁轨机tnt复制机)
- [空置域](#空置域)
  - [三向轰炸机](#三向轰炸机)
- [思考](#思考)

<!-- /TOC -->

# TNT和爆炸

TNT是红石元件，其被激活时会点燃。除此之外，打火石、火焰弹、发射器发射、带有火矢的箭、火、岩浆等多种方式都可以点燃TNT。

TNT点燃后，在原方块位置底面中心点，即(+0.5, 0, +0.5)生成一个TNT实体，其是一个棱长为0.98的正方体。随后删除原方块。如果TNT被激活或被打火石引燃，其会在80游戏刻后爆炸；如果它因爆炸而被点燃，则它会在10至30游戏刻后爆炸。一般我们讨论的都是由红石电路激活的TNT。爆炸倒计时由Fuse标签记录，刚被点燃时，记为80，不断递减，为0时立即爆炸，删除TNT实体。

爆炸将会产生在TNT地面正中心向上0.06125（=0.98÷16）格。爆炸威力$P$为4，爆炸威力决定物品的掉落率：掉落率=1÷爆炸威力（龙蛋、信标、潮涌核心、头颅、潜影盒总是掉落）。常见的爆炸和威力如下：

- 凋灵生成：7
- 末影水晶爆炸：6
- 闪电苦力怕：6
- 床、重生锚：5（生成火）
- TNT：4（100%掉落）
- 苦力怕：3
- 恶魂火球：1（生成火）
- 凋灵之首：1（蓝色凋灵之首将大部分方块的爆炸抗性视为不超过0.8）

爆炸是即时且独立的，即爆炸产生后立即计算结果并对世界产生影响。如果同一游戏刻有多个爆炸产生，则它们分别计算。每个爆炸结束后再进行下一个爆炸的计算。这意味着不可能用多个TNT爆炸炸毁一个TNT理论上所不能炸毁的方块，方块并不存在某种“爆炸生命值”。

从爆心开始，爆炸会产生1352条爆炸射线：其构成以爆心为中心的一个立方体的表面，每个表面都被均匀地按正方形投射了16×16的爆炸射线。每条射线都有爆炸威力×（0.7\~1.3）的初始爆炸强度，对TNT来说就是2.8\~5.2。爆炸每沿射线方向前进0.3格就衰减0.225，且非空气方块还会使爆炸强度再下降(爆炸抗性+3)×0.3。所有衰减分段采样点上未能使爆炸强度衰减到0的方块都会被破坏。破坏是在所有射线计算完毕后进行的，因此每个方块可以吸收多条爆炸射线或一条爆炸射线的多个分段采样点，即使这个方块很容易被爆炸破坏。爆炸射线的分段采样点只考虑采样点的方块坐标，而不考虑是否位于碰撞箱内。这意味着在半砖上爆炸的TNT总会被半砖吸收大量的爆炸射线，落在末影箱上的TNT会隔绝一切爆炸，达到防爆的效果。

//在这里加一张由指令生成的巨大爆炸威力的图片。

爆炸半径$r=2P$。以爆心为中心，$r$为半径的球体是爆炸的伤害范围，在伤害范围内的所有实体（底面中心点，距离爆心为$d$）都会受到影响。爆炸冲击力$v=(1-d/r)α$，其中$α$是爆炸接触率。实体受到的伤害为$7(v^2+v)P+1$的向下取整。实体获得从爆心向实体的眼部高度中心（TNT仍是底面中心）方向，大小为$v$的速度。这意味着多个TNT可以造成更多的伤害，增加更多的速度。

爆炸接触率是从爆心向实体内部若干网格点的连线中，没有被阻挡的比率。网格点取点的位置并不均衡，数量则和实体的大小有关，实体越大取点越多。没有阻挡时，爆炸接触率自然是100%。

TNT实体生成后，会得到0.2m/gt向上的垂直速度，和0.02m/gt的随机水平方向速度。TNT是ASD实体，重力加速度0.04，阻尼0.98，终端速度1.96。当TNT上方无方块遮挡时，4gt后达到最高点，此时向上跃起0.384格，累计向下掉落73.454格；当TNT上方有方块阻挡时，TNT会在1gt之内向上跃起0.02格，随后被触顶而速度归零，接下来自由落体79.865格，累计向下掉落或79.845格。

![](assets/markdown-img-paste-20220101210011422.png)

1.14的快照19w11a之前，TNT爆炸破坏36号方块（Moving Piston）时会有100%的掉落率，而破坏一般的方块只有25%的掉落率。19w11a之后，TNT和TNT矿车的掉落率都变为100%。不过玩家仍然会让被TNT炸掉的方块处于36号方块的状态，因为36号方块有更低的爆炸抗性（0），同一个TNT可以破坏更多的方块。

1.14加入了流浪商人，其使沙子可再生，进而使TNT可再生。在此之前，生存玩家一般使用刷沙机或TNT复制机来制作大量TNT。

# 当活塞开始推动

在1.9的快照15w42a中，Myren Eairo发现了TNT复制的方法：用活塞推动处于BUD态的TNT。此时TNT正常推出，但TNT实体仍旧会生成。这一BUG随后被修复，但修复不完全，TNT复制机的设计方案如雨后春笋般冒了出来，直到现在（1.18.1）都有大量可用的TNT复制方案。

![](assets/markdown-img-paste-20220101214151488.png)

上图是一个可用的TNT复制，粘性活塞收回时TNT将被复制。该BUG同样利用了处于BUD态的TNT，但现在装置下方有一个失活的珊瑚扇。这一装置在1.13以后可以稳定运行，而1.13也是NC更新和PP更新成型的时期，我们以这个版本为例介绍TNT复制的原理。

珊瑚扇提供了TNT复制所需要的方块更新。为了解释TNT是如何复制的，我们首先介绍活塞是如何处理运动方块和附着的方块的。

当活塞激活时，其首先会自检，检查自己能否推出。活塞满足推出条件后，它会将所有需要移动的方块计入列表。该列表的排列顺序，就是我们在活塞更新次序理论中介绍过的顺序。另外，被破坏的方块也会被计入另一个列表，顺序也遵循更新次序理论。

![](assets/markdown-img-paste-20220101224822857.png)

现在，活塞开始移动，其首先破坏应当破坏的方块，西瓜块在这一阶段被破坏，这一阶段不产生方块更新，地毯悬空，不会掉落。西瓜在这里应当产生NC更新，缺失的NC更新会在所有PP更新结束后再发出。

此后，活塞按次序在相应位置放置36号方块，如果该位置有方块则会直接被替换掉。放置36号方块的过程产生PP更新，火把因此掉落。地毯收到了PP更新，但不会掉落，因为地毯可以附着在任何非空气方块上，也包括36号方块。

最后，是那些没有被替换却应当被删除的方块，例如红石火把下方的粘液块，都会在这一阶段被删除。所有应当被删除的方块被放入一个哈希集中，产生PP更新，因而它们的顺序是按位置随机的，红石火把在这里一阶段掉落。被删除的方块都是不应当存在的，因此不会产生破坏音效和掉落物。（1.15后，游戏会先将所有方块无更新地替换为空气，再统一发出PP更新）

[-_-]:1.15之后这里会先把所有方块替换为空气，再由空气发出PP更新。

现在开始NC更新，所有被破坏的方块按顺序发出NC更新，例如这里的西瓜。如果地毯位置是铁轨则会在这一阶段掉落，铁轨在收到NC更新时检查，其下必须是表面完整的方块，36号方块表面不完整。最后是所有被移动的方块按顺序发出NC更新。

而后，活塞携带粘液块结构正常推出。

总的来看，活塞运动前会在它们的目的地放置36号方块，并将每个方块删除，在上述位置产生NC更新和PP更新。但方块的最前端例外，它只产生PP更新而不产生NC更新。我们在方块更新和方块变化一节中提到，常规BUD不响应方块的移入，而观察者却会响应，就是由于这个原因。

![](assets/markdown-img-paste-20220102151122318.png)

如上的装置也可说明这一点，落下拉杆，最前端的铁轨并不会立即掉落，它会在铁块就位后收到NC更新，进而掉落。

![](assets/markdown-img-paste-20220102151148101.png)

当活塞要移除一些方块时，如破坏应当破坏的方块、用36号方块替换原先的方块时，这些方块的更新往往被抑制，如铁轨被移除时就不产生任何额外的更新。但有些方块可能产生额外的更新，如活塞破坏红石线时的方块更新就是在这时产生的。除此之外，观察者的更新都不会被抑制。

现在我们总结活塞推动瞬间所发生的事情：
- 自检
- 破坏方块，不产生更新
- 创建36号方块，产生PP更新
- 删除方块，哈希顺序，产生PP更新
- 被破坏了的方块产生NC更新
- 被移动了的方块产生NC更新

其中，如果涉及到了一些额外的方块，如观察者、红石线等，则先去完成它们自身的更新，再继续推动过程。

# 刷地毯机、刷铁轨机、TNT复制机

![](assets/markdown-img-paste-20220102001301767.png)

这是一台刷地毯机，每次粘性活塞收回时，都会有一个地毯刷出。

首先，创建移动方块列表。最先移动的是下方粘液块，其次是珊瑚扇，产生PP更新，但原先的珊瑚扇还未删除，且此时附着在珊瑚扇的36号方块上，因而被破坏，产生NC更新和PP更新。地毯因为下方珊瑚扇被破坏而掉落。之后，创建上方粘液块和地毯的36号方块。此后活塞正常收回，地毯被复制。

当活塞推出时，并不会有这样的问题。首先创建珊瑚扇的36号方块，用下方粘液块的36号方块替换珊瑚扇，更新到地毯，不过地毯可以附着在36号方块上，所以并不会掉落。接着放置地毯的36号方块，用上方粘液块的36号方块替换地毯。其后活塞推出。

而TNT复制机的原理，无非就是将地毯换为了BUD态的TNT而已。

[>_<]: 这里多几个刷地毯机和刷铁轨机

![](assets/TNT复制-b855e74e.png)

这是一台刷铁轨机，这个机器只有在活塞推出时，且是在活塞刚收回后又被观察者激活才会刷出铁轨。

活塞收回完毕后，两个观察者都准备激活，由于NTE优先于BE，活塞准备推出时两个观察者都是点亮的。活塞推出后，先移动最下层粘液块，发出PP更新，铁轨不会掉落。接着移动观察者，观察者本身处于激活状态，所以被移动时要产生额外的更新信号，这个更新信号是完整的，包含NC和PP更新。铁轨因而检查到其下是36号方块而掉落，这就复制了铁轨。

这个装置不仅可以复制动力铁轨，也可以复制其他任意类型的铁轨。

![](assets/TNT复制-e9928ab6.png)

这样是没办法刷铁轨的。

![](assets/TNT复制-33312850.png)

地毯可以附着在36号方块上，所以不能用这种方法刷取。不过我们可以在刷铁轨的同时刷一些地毯。

如下是TNT复制机。TNT处于BUD态，信号源是上方矿车和探测铁轨。圆石墙用于拦住矿车，防止它从机器上掉下去。TNT是在活塞收回时复制的。

![](assets/TNT复制-657dd167.png)

TNT处于BUD态，所以这种机器很危险，在制作时要时刻小心不能更新到TNT，以防“炸膛”。制作机器时可以通过活塞将探测铁轨和活塞推到正确的位置，或者将机器拆成两部分，让活塞推出收回一次来装配好这个复制机，比如下面这样：

![](assets/TNT复制-9d9f4dfa.png)

下面这个有趣的TNT复制机会在活塞推出时复制TNT，然后将TNT弹射出去！

![](assets/TNT复制-a05d2c77.png)

下面这个TNT复制机可以在活塞推出和收回时分别复制一个TNT，原理是后面两个蓝色混凝土的36号方块更新珊瑚扇，进而更新TNT。

![](assets/TNT复制-3f4c8630.png)

在生存游戏中，玩家可以利用TNT复制机破坏地形，清除一定区域内的方块，以期制作各种形式的农场。有意思的是，有些玩家会用TNT复制机来制作史莱姆农场，那么在没有粘液块前该如何制作TNT复制机呢？在“节省耗材”的口号下，无粘液块、无粘性活塞甚至无珊瑚扇的TNT复制机都被制作出来了，如下便是一例。

![](assets/TNT复制-7a7db808.png)

![](assets/TNT复制-aa1c4f9b.png)

TNT被推出，随后被另一侧的活塞复位。复位的活塞推出时TNT复制。复位活塞是被观察者激活的，而观察者给出信号时，改变了黄色混凝土的指向，使之不能充能左侧的混凝土，进而无法激活背后的TNT。此后复位活塞开始推出，观察者被推动，发出NC更新和PP更新使得黄色位置红石线失去信号，强度降为13，同时指向混凝土。

此时能否复制TNT，还需要看究竟是活塞先将TNT推走，还是红石线先更新到TNT。红石线全部更新完之后活塞才会继续推动，想要让TNT复制，则红石线必须在熄灭前更新到TNT。这是可以做到的，半砖上的红石线若要熄灭必须更新到TNT，如果它不更新到TNT，则必须维持11强度，此时黄色位置红石线强度至少为7。所以黄色位置和半砖位置的红石线至少有一个会更新到TNT。

# 空置域

将TNT复制机与粘液块飞行器结合，我们就得到了一台“轰炸机”。由于TNT在点燃后可以自由落体约78格，像这样的轰炸机可以在移动时将其下78格的方块破坏掉，这使得破坏大规模地形成为可能。

![](assets/TNT复制-958e6b98.png)

我们又不是熊孩子，为什么要大规模破坏地形呢？事实上，在生存游戏中，清空一个甚至一大片区块，使之只保留基岩是一件非常有意义的事——这使得周围的区块中没有可以刷怪的地方，极大地提高刷怪塔的效率。发展到现在，清空区块而仅仅用作装饰用途的玩家甚至也不在少数。

然而，在TNT复制出现前，清空区块是一件消耗大量人力成本的事，这使得很多玩家对此望而却步，一般只有大型的生存服务器，才会将这样方案纳入考虑之中。比起挖掉上千万个方块，将整个范围内可刷怪的地方全部点亮是一般玩家的做法。

随着TNT复制的发现，清空区块这一行为的成本越发低廉，“点洞”这一词也逐渐淡出玩家的视野。随着三向轰炸机和世界吞噬者的问世以及人们对清空区块关注度的提高，2018年10月29日，在经过一周的投票后，“空置域”一词以227票在481人的投票中胜出，成为“perimeter
”的中文翻译，即“被清空的区块”的正式术语。在玩家们的普遍使用下，这一词逐渐普及，越来越多的人了解并制作空置域，现在即使是单人的生存也可以负担起一个甚至数个大型空置域了。

空置域和TNT复制技术相辅相成，可以说空置域的需要极大地带动了TNT轰炸机的发展，衍生出的相关科技树也是愈发的枝繁叶茂，极大地促进了生存电路在这一领域的蓬勃发展。

在清空区块方面，主要的机器是三向轰炸机和世界吞噬者，在地狱中使用的世界吞噬者有着机器高度更低的特点，称为地狱吞噬者。为炸出容纳地狱吞噬者的空间，往往需要使用可以炸出隧道的盾构机。在其他辅助的方面，铺墙机、铺水机、铺地板机、铺铁砧机等机器也可以很好地减少玩家的机械性操作。

## 三向轰炸机

三向轰炸机，顾名思义，其可以在前后往返轰炸一次后向侧向移动一格，进而炸出一片方形区域。

这是Comet 107为制作的三向轰炸机。

![](assets/TNT复制-faf71214.png)

在中间飞行着的是轰炸机，左侧装置负责在轰炸机往返一次后将轰炸机侧移一格，右侧的半自动机是一个返回站，其允许轰炸机返回，自身也会移动一格。



![](assets/TNT复制-5aaec6ae.png)

# 思考

思考：携带TNT和必要的方块，如何在挖掘疲劳的负面效果下，快速攻略海底神殿？

思考：设计实验证明活塞在将方块转变为36号方块时，PP更新总优先于NC更新。

思考：设计实验证明，活塞在删除多余方块时发出的PP更新的顺序并不一定遵循更新次序理论。

思考：为什么火把和死珊瑚扇都不能附着在36号方块上，前者在粘液块移动时会被破坏，而后者则不会。

![](assets/markdown-img-paste-20220102011912264.png)

思考：比较三台机器在激活和撤销激活时，分别会产生几次珊瑚破坏的音效，为什么？

![](assets/markdown-img-paste-20220102013459768.png)

思考：以下两台机械，在活塞伸出收回一次可以复制几个地毯，分别是在什么时候？
